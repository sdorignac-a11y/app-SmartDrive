<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Drop Calculator Fortnite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #020617;
      color: #e5e7eb;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
    }
    h1 { margin-bottom: 0.3rem; }
    .sub { color: #9ca3af; margin-bottom: 1rem; }

    .wrapper {
      background: #020617;
      border: 1px solid rgba(148,163,184,0.4);
      border-radius: 1rem;
      padding: 1rem;
      width: 100%;
      max-width: 900px;
    }

    canvas {
      width: 100%;
      height: auto;
      border-radius: 0.75rem;
      border: 1px solid rgba(148,163,184,0.4);
    }

    button {
      margin-top: .7rem;
      padding: .5rem 1rem;
      background: linear-gradient(135deg,#38bdf8,#a855f7);
      border: none;
      border-radius: 999px;
      color: white;
      font-weight: 600;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>Drop Calculator – Fortnite</h1>
<p class="sub">Click 1: inicio del bus · Click 2: final del bus · Click 3: spot</p>

<div class="wrapper">
  <canvas id="mapCanvas" width="1024" height="1024"></canvas>
  <button onclick="resetMap()">Reiniciar</button>
  <p id="info"></p>
</div>

<script>
  const canvas = document.getElementById("mapCanvas");
  const ctx = canvas.getContext("2d");

  const info = document.getElementById("info");

  let mapImg = new Image();
  mapImg.src = "https://i.imgur.com/2lUJ4NQ.jpeg";  // << Mapa real Fortnite
  mapImg.onload = () => drawEverything();

  let busStart = null;
  let busEnd = null;
  let spot = null;

  function resetMap() {
    busStart = null;
    busEnd = null;
    spot = null;
    drawEverything();
    info.innerHTML = "Hacé clic en el mapa para marcar el inicio del bus.";
  }

  function drawEverything() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(mapImg, 0, 0, canvas.width, canvas.height);

    drawPoint(busStart, "#22c55e");
    drawPoint(busEnd, "#ef4444");
    drawPoint(spot, "#facc15");

    if (busStart && busEnd) {
      ctx.strokeStyle = "#38bdf8";
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(busStart.x, busStart.y);
      ctx.lineTo(busEnd.x, busEnd.y);
      ctx.stroke();
    }

    if (busStart && busEnd && spot) {
      let { jumpPoint, porcentaje } = calcularJump(busStart, busEnd, spot);
      drawPoint(jumpPoint, "#a855f7");

      info.innerHTML = `
        <strong>Punto perfecto de salto:</strong><br>
        • Tirate en el <strong>${porcentaje.toFixed(1)}%</strong> del recorrido del bus.<br>
        • Coordenadas: (${jumpPoint.x.toFixed(0)}, ${jumpPoint.y.toFixed(0)})
      `;
    }
  }

  function drawPoint(p, color) {
    if (!p) return;
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.arc(p.x, p.y, 7, 0, Math.PI * 2);
    ctx.fill();
  }

  function calcularJump(S, E, P) {
    const vx = E.x - S.x;
    const vy = E.y - S.y;

    const wx = P.x - S.x;
    const wy = P.y - S.y;

    let t = (wx * vx + wy * vy) / (vx * vx + vy * vy);

    if (t < 0) t = 0;
    if (t > 1) t = 1;

    let J = {
      x: S.x + vx * t,
      y: S.y + vy * t
    };

    return { jumpPoint: J, porcentaje: t * 100 };
  }

  canvas.addEventListener("click", (e) => {
    const rect = canvas.getBoundingClientRect();
    const x = ((e.clientX - rect.left) / rect.width) * canvas.width;
    const y = ((e.clientY - rect.top) / rect.height) * canvas.height;

    if (!busStart) {
      busStart = { x, y };
      info.innerHTML = "Ahora marcá el final del bus.";
    } else if (!busEnd) {
      busEnd = { x, y };
      info.innerHTML = "Ahora marcá el spot donde querés caer.";
    } else if (!spot) {
      spot = { x, y };
    } else {
      resetMap();
      return;
    }

    drawEverything();
  });

  resetMap();
</script>

</body>
</html>
